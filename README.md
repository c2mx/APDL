# :memo:APDL
APDL（ANSYS Parametric Design Language）主要用于自动化重复性任务，用于提高工作效率。

## 宏文件格式
宏文件扩展名为.mac，文件名只能包含字母和数字，且开头为字母。

## 如何调用宏
将宏文件放在工作目录下，在ANSYS的命令窗口里输入宏文件名（不用区分大小写，不用加后缀），然后回车即可执行。

## 宏文件中如何定义变量
直接用 `变量名 = 参数` 即可定义变量并赋值，变量名同样只能包含字母和数字，且开头为字母。APDL对字母大小写不敏感，也就是说同个字母，大小写是等价的。变量  `a` 和变量 `A` 是相同的。

## :rotating_light:在节点上施加外力时，BEAM189单元慎用截面偏置功能
梁单元BEAM189的截面偏置（SECOFFSET命令）功能为用户提供了方便，通过该功能可以调整梁的几何位置，例如偏心连接或变截面情况；但在某些情况下使用时应特别谨慎，甚至不能使用截面偏置功能。在梁单元BEAM189的HELP中有基本介绍，大意是在节点（定义单元x轴）上施加外荷载时，如果质心轴与单元x轴不共线，则所施加的轴力荷载将导致弯曲；当截面的质心与剪心不重合时，施加的剪切荷载将导致扭转应变和力矩；因此“节点”应位于要施加外荷载的位置，应适当地(appropriately)使用SECOFFSET命令的OFFSETY和OFFSETZ参数。
HELP中的“适当地(appropriately)”说的很委婉，实际上，节点上若有轴力或横向力 (与偏置的方向不同时)外荷载，使用截面偏置就会导致不正确的结果，或者说在此外荷载（轴力或与偏置方向不同的横向力）情况下，就不能使用截面偏置。因此，当节点上有外力荷载时建议慎用截面偏置功能。但若节点上不施加外力荷载，而是内力在截面间传递，即便截面上有轴力或横向力，使用截面偏置也不会影响结果。
变截面悬臂梁如图1a)所示，采用BEAM189单元模拟时，根据传统力学理论，采用截面质心轴建模。变截面部分，采用梁截面中的变截面类型（TAPER）定义梁截面。由于采用了截面质心轴建模，因此截面不需设置偏置，即各截面位于质心，有限元模型如图1b)和c)所示。
![示例图片](/images/sample.jpeg)

在悬臂端施加竖向荷载和水平荷载后，结果如图1d)和e)所示。因节点施加外荷载，节点位置应该在外荷载作用点上，因此采用无截面偏置的质心轴建模。这种模型仅在带单元形状显示时，截面因垂直轴线而略有倾斜，但不会影响计算结果。计算分析的命令流如下。

[示例命令流](sample.mac)

如果在直线位置建模，并设置截面偏置，无论怎样施加外荷载（考虑移轴的弯矩与否）均不能得到正确结果（如图2）。因此，当节点上有外荷载作用并与截面偏置方向不同时，不能使用截面偏置功能。
